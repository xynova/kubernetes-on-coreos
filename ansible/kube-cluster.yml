---

- hosts: [ etcd, kube-masters, kube-addon-workers ]
  gather_facts: false
  pre_tasks:
    - include: tasks/transfer-workfiles.yml
  roles:
    - pre-any
  post_tasks:
    - include: tasks/prep-workCerts.yml
  #strategy: free
  tags: always

- hosts: etcd
  gather_facts: false
  roles: 
    - etcd 
  strategy: free
  tags: etcd

- hosts: kube-masters
  gather_facts: false
  roles:
    - pre-kube
    - flannel
    - kube-master
  post_tasks:
    - include: tasks/prep-admin-kubeconfig.yml
    - include: tasks/prep-kubeClient.yml
  strategy: free
  tags: kube-masters


- hosts: kube-masters
  gather_facts: false
  run_once: true
  roles:
    - kube-master-extras
  tags: kube-master-extras

- hosts: kube-addon-workers
  gather_facts: false
  roles:
    - pre-kube
    - flannel
    - kube-worker
  post_tasks:
    - include: tasks/prep-admin-kubeconfig.yml
    - include: tasks/prep-kubeClient.yml
  strategy: free
  tags: kube-addon-workers

- hosts: [ etcd, kube-masters, kube-addon-workers ]
  gather_facts: false
  tasks:
    - include: tasks/cleanup-deployment-artifacts.yml
  strategy: free
  tags: always



